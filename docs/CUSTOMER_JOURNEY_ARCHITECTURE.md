# üéØ ARQUITECTURA CUSTOMER JOURNEY + EMAIL MARKETING
## Sistema completo tipo HubSpot para Itineramio

---

## üìä VISI√ìN GENERAL

### El Objetivo
**Trackear cada usuario desde el primer contacto hasta conversi√≥n (o churn), identificando puntos de fricci√≥n y optimizando conversiones.**

### Los Principios
1. **"Cada email debe ser una joya"** - Calidad sobre cantidad
2. **No molestar** - Solo comunicar cuando aportamos valor real
3. **Personalizaci√≥n** - Contenido seg√∫n etapa y comportamiento
4. **Data-driven** - Decisiones basadas en m√©tricas reales

---

## üõ§Ô∏è CUSTOMER JOURNEY STAGES

### 1. VISITOR (Visitante An√≥nimo)
**Entrada:** Primera visita a la web
**Caracter√≠sticas:**
- No identificado (solo analytics an√≥nimos)
- Navegando contenido (blog, hub, landing pages)
- Fuente: Org√°nico, redes sociales, ads, directo

**Objetivos:**
- ‚úÖ Identificarse (dejar email)
- ‚úÖ Consumir contenido de valor
- ‚úÖ Generar inter√©s

**KPIs:**
- P√°ginas vistas
- Tiempo en sitio
- Bounce rate
- Conversi√≥n a Lead

---

### 2. LEAD (Lead Captado)
**Entrada:** Descarga recurso del Hub / Se suscribe a blog
**Caracter√≠sticas:**
- Tenemos: Nombre + Email
- Inter√©s mostrado: Herramienta/recurso espec√≠fico descargado
- NO ha creado cuenta a√∫n

**Objetivos:**
- ‚úÖ Nutrir con contenido relevante
- ‚úÖ Generar confianza
- ‚úÖ Empujar a crear cuenta (registrarse)

**KPIs:**
- Tasa de apertura emails
- Click-through rate
- Conversi√≥n a Registro

**Emails t√≠picos:**
1. **Bienvenida** (inmediato) - Entregar recurso + presentar Itineramio
2. **Educacional** (d√≠a 2) - C√≥mo usar el recurso descargado
3. **Caso de uso** (d√≠a 5) - Historia de √©xito relacionada
4. **Call to action** (d√≠a 7) - Invitaci√≥n a probar gratis

---

### 3. REGISTERED (Usuario Registrado - Trial)
**Entrada:** Crea cuenta en Itineramio
**Caracter√≠sticas:**
- Usuario activo en plataforma
- En per√≠odo de prueba (15 d√≠as gratis)
- Primera propiedad incluida

**Objetivos:**
- ‚úÖ Completar onboarding
- ‚úÖ Crear su primer manual digital
- ‚úÖ Ver valor inmediato
- ‚úÖ Convertir a pago antes de fin de trial

**KPIs:**
- % onboarding completado
- Tiempo hasta primer manual creado
- Features m√°s usados
- Engagement (logins, tiempo en app)
- Conversi√≥n trial ‚Üí paid

**Emails t√≠picos:**
1. **Bienvenida a la app** (inmediato) - Tour guiado
2. **Tips de setup** (d√≠a 1) - C√≥mo crear primer manual en 5 min
3. **Feature highlight** (d√≠a 3) - Descubre los QR codes
4. **Success milestone** (cuando crea manual) - ¬°Felicitaciones!
5. **Recordatorio trial** (d√≠a 10) - Te quedan 5 d√≠as
6. **√öltima oportunidad** (d√≠a 14) - Hoy termina tu trial

---

### 4. MQL (Marketing Qualified Lead)
**Entrada:** Usuario activo que muestra se√±ales de inter√©s comercial
**Caracter√≠sticas:**
- Ha creado al menos 1 manual
- Visita p√°gina de pricing 2+ veces
- Descarga 3+ recursos
- Engagement score alto

**Objetivos:**
- ‚úÖ Educarlo sobre planes superiores
- ‚úÖ Mostrar ROI claro
- ‚úÖ Destacar casos de √©xito similares
- ‚úÖ Facilitar conversaci√≥n con sales (si aplica)

**KPIs:**
- Scoring de engagement
- Interacci√≥n con contenido premium
- Respuesta a emails

**Emails t√≠picos:**
1. **Case study personalizado** - Alguien como t√∫ logr√≥ X
2. **Comparativa de planes** - Qu√© plan es mejor para ti
3. **Calculadora de ROI** - Cu√°nto ahorrar√°s
4. **Oferta limitada** (si aplica) - Descuento por early adopter

---

### 5. SQL (Sales Qualified Lead)
**Entrada:** Solicita demo, pide hablar con sales, o llena formulario de contacto
**Caracter√≠sticas:**
- Inter√©s expl√≠cito en comprar
- Posiblemente m√∫ltiples propiedades
- Necesita plan Business o superior
- Puede tener preguntas espec√≠ficas

**Objetivos:**
- ‚úÖ Respuesta r√°pida (< 2 horas)
- ‚úÖ Proporcionar info personalizada
- ‚úÖ Cerrar venta

**KPIs:**
- Tiempo de respuesta
- Tasa de conversi√≥n SQL ‚Üí Customer
- Tama√±o promedio de deal

**Emails t√≠picos:**
1. **Confirmaci√≥n** (inmediato) - Recibimos tu solicitud
2. **Informaci√≥n solicitada** (< 2h) - Respuesta personalizada
3. **Follow-up** (si no responde en 2 d√≠as)
4. **Re-engagement** (si se enfr√≠a)

---

### 6. CUSTOMER (Cliente Pagando)
**Entrada:** Completa pago y activa suscripci√≥n
**Caracter√≠sticas:**
- Paga plan mensual/anual
- Usuario activo de la plataforma
- Puede tener m√∫ltiples propiedades

**Objetivos:**
- ‚úÖ Maximizar uso del producto (activation)
- ‚úÖ Prevenir churn
- ‚úÖ Upsell a planes superiores
- ‚úÖ Generar advocacy (referidos)

**KPIs:**
- NPS (Net Promoter Score)
- Feature adoption rate
- Churn rate
- Expansion revenue (upsells)
- Lifetime value

**Emails t√≠picos:**
1. **Bienvenida premium** - Gracias por confiar en nosotros
2. **Tips avanzados** (semanal) - S√°cale m√°s provecho
3. **Nuevos features** (cuando lanzamos algo)
4. **Check-in mensual** - ¬øC√≥mo va todo?
5. **Oportunidades de upgrade** - Has llegado al l√≠mite, considera plan superior
6. **Pedido de review/referido** (despu√©s de 3 meses activo)

---

### 7. CHURNED (Cliente Cancelado)
**Entrada:** Cancela suscripci√≥n
**Caracter√≠sticas:**
- Ex-cliente
- Raz√≥n de cancelaci√≥n registrada
- Posible win-back target

**Objetivos:**
- ‚úÖ Entender por qu√© se fue
- ‚úÖ Mantener puerta abierta
- ‚úÖ Win-back campaign (cuando sea apropiado)

**KPIs:**
- Razones de churn (categor√≠as)
- Tasa de win-back
- Tiempo hasta win-back

**Emails t√≠picos:**
1. **Survey de salida** (inmediato) - ¬øPor qu√© nos dejas?
2. **Quedamos en contacto** - Siempre ser√°s bienvenido
3. **Win-back offer** (3 meses despu√©s) - Vuelve con descuento
4. **Nuevos features** (6 meses) - Mira lo que hemos mejorado

---

## üéØ SCORING SYSTEM

### Lead Scoring
Cada acci√≥n suma puntos. Al llegar a umbral ‚Üí cambio de stage.

**Acciones demogr√°ficas (+):**
- Tiene m√∫ltiples propiedades: +10
- Role: Property Manager: +15
- Ubicaci√≥n en ciudad tur√≠stica: +5

**Acciones de engagement (+):**
- Descarga recurso: +5
- Lee art√≠culo blog completo: +3
- Visita pricing page: +10
- Completa perfil: +8
- Crea primer manual: +20
- A√±ade segunda propiedad: +15
- Login 3 d√≠as consecutivos: +10
- Invita a team member: +12

**Acciones negativas (-):**
- No abre emails (3 consecutivos): -5
- No login en 7 d√≠as: -8
- No login en 30 d√≠as: -20

**Umbrales:**
- 0-20: Lead
- 21-50: Engaged Lead
- 51-80: MQL
- 81+: SQL

---

## üìß EMAIL MARKETING SYSTEM

### Arquitectura de Emails

#### 1. Transactional Emails (Triggered autom√°ticamente)
**Provider recomendado:** Resend (mejor DX, mejor deliverability)

**Tipos:**
- Welcome emails
- Password resets
- Confirmaciones
- Notificaciones de actividad
- Invoices

**Caracter√≠sticas:**
- Env√≠o inmediato
- Alta prioridad de entrega
- Templates en c√≥digo (React Email)
- Personalizaci√≥n din√°mica

---

#### 2. Marketing Emails (Campa√±as nurturing)
**Provider recomendado:** Resend o Loops.so

**Tipos:**
- Drip campaigns (secuencias)
- Newsletters (manual)
- Anuncios de features
- Content digests

**Caracter√≠sticas:**
- Env√≠o programado
- Segmentaci√≥n avanzada
- A/B testing
- Analytics detallados

---

### Principio: "Cada Email es una Joya" üíé

**Checklist antes de enviar cualquier email:**

1. **¬øAporta valor real?**
   - ‚ùå "Hola, solo record√°ndote que existimos"
   - ‚úÖ "Aqu√≠ est√° el template de limpieza que pediste + 3 tips para usarlo"

2. **¬øEs el momento adecuado?**
   - Usar behavioral triggers, no solo tiempo
   - Ejemplo: Email de "segunda propiedad" solo cuando est√°n activos en la primera

3. **¬øEs personal y relevante?**
   - Usar nombre, contexto, comportamiento
   - Segmentar por stage, industria, ubicaci√≥n

4. **¬øTiene un solo objetivo claro?**
   - Un email = una acci√≥n
   - CTA √∫nico y prominente

5. **¬øEl dise√±o es impecable?**
   - Mobile-first
   - Jerarqu√≠a visual clara
   - Brand consistency

6. **¬øEl copy es conciso y humano?**
   - Lenguaje cercano, no corporativo
   - P√°rrafos cortos
   - Sin jerga innecesaria

---

### Email Sequences por Stage

#### LEAD ‚Üí REGISTERED (7 d√≠as)
**Objetivo:** Conseguir que se registre

D√≠a 0 (inmediato): **"Aqu√≠ est√° tu [recurso]"**
```
Subject: ‚úÖ Tu [Checklist/Template] est√° listo
Preview: Descarga + 3 tips para sacarle m√°ximo provecho

Hola [Nombre],

Aqu√≠ est√° tu [recurso]. [Link de descarga]

üéØ 3 formas de usarlo hoy mismo:
1. [Tip espec√≠fico]
2. [Tip espec√≠fico]
3. [Tip espec√≠fico]

PD: ¬øSab√≠as que con Itineramio puedes digitalizar esto
y compartirlo con un QR? Es gratis probar ‚Üí [CTA]
```

D√≠a 2: **"C√≥mo [nombre de usuario] ahorr√≥ 15 horas/mes"**
```
Subject: [Nombre de host] ahorr√≥ 15h/semana con esto
Preview: Su historia + c√≥mo replicarla

Case study real de alguien en situaci√≥n similar.
Mostrar el antes/despu√©s.
CTA suave: "Pru√©balo gratis"
```

D√≠a 5: **"Los 3 errores que cometen todos los anfitriones"**
```
Subject: üö® Evita estos 3 errores (costosos)
Preview: El #2 te sorprender√°...

Contenido educacional de valor.
Sin pitch de venta directo.
Construir autoridad.
```

D√≠a 7: **"Tu prueba gratuita te espera"**
```
Subject: [Nombre], tu Airbnb merece esto
Preview: Primera propiedad gratis para siempre

Hey [Nombre],

Has descargado [X recursos] en la √∫ltima semana.
Claramente est√°s buscando optimizar tu gesti√≥n.

¬øQu√© tal si pruebas la versi√≥n completa?
‚Üí Primera propiedad GRATIS para siempre
‚Üí 15 d√≠as para probar todo
‚Üí Sin tarjeta de cr√©dito

[CTA grande: Empezar ahora]
```

---

#### REGISTERED ‚Üí CUSTOMER (15 d√≠as trial)
**Objetivo:** Activaci√≥n y conversi√≥n a pago

D√≠a 0: **"Bienvenido a Itineramio"**
```
Onboarding email con:
- Video tour (2 min)
- "Crea tu primer manual en 5 minutos"
- Acceso a soporte
```

D√≠a 1: **"Tu checklist de primeros pasos"**
```
‚úÖ Paso 1: Agregar tu propiedad
‚úÖ Paso 2: Subir 3 fotos
‚úÖ Paso 3: Crear primera secci√≥n
‚úÖ Paso 4: Generar tu QR

[Progreso visual: 0/4]
```

D√≠a 3: **Feature highlight: "El poder de los QR codes"**
```
Mostrar feature espec√≠fico.
Video demo.
Ejemplo real de uso.
```

D√≠a 5: **Milestone celebration** (solo si cre√≥ manual)
```
Subject: üéâ ¬°Tu primer manual est√° listo!

[Nombre], acabas de crear tu primer manual digital.
Esto es lo que significa:

üìâ 86% menos consultas sobre WiFi
‚è∞ 8 horas/semana ahorradas
‚≠ê Mejores reviews (promedio)

[CTA: Comparte tu manual]
```

D√≠a 7: **Mid-trial check-in**
```
Subject: ¬øC√≥mo va todo, [Nombre]?

Llevamos una semana juntos.
¬øPuedo ayudarte con algo?

Responde a este email con cualquier pregunta.
(S√≠, leo todas las respuestas personalmente)

- [Founder name]
```

D√≠a 10: **"Te quedan 5 d√≠as"**
```
Subject: Recordatorio: 5 d√≠as de trial restantes

Sin presi√≥n, solo un heads up.

Si decides continuar:
‚Üí Elige tu plan aqu√≠
‚Üí Primera propiedad siempre gratis
‚Üí Cancela cuando quieras

Si no es para ti:
‚Üí Cu√©ntame por qu√© (mejoramos)
‚Üí Mant√©n acceso a recursos gratuitos

[CTA: Ver planes]
```

D√≠a 14: **"Hoy termina tu trial"**
```
Subject: [Nombre], hoy es el d√≠a

Tu trial termina en unas horas.

¬øQu√© te impide continuar?
‚Üí Precio: Hablemos, tengo opciones
‚Üí Features: Dime qu√© necesitas
‚Üí No es para ti: Ok, sin problema

[CTA principal: Activar plan]
[CTA secundario: Hablar conmigo]
```

---

#### CUSTOMER ‚Üí ADVOCATE (Ongoing)
**Objetivo:** Retenci√≥n, upsell, referidos

**Mensual:** Newsletter "Tips del mes"
```
1 tip accionable.
1 feature update.
1 case study.
Ratio 90% valor / 10% promoci√≥n.
```

**Triggered:** L√≠mite de plan alcanzado
```
Subject: üéØ Has alcanzado [X propiedades]

Esto es genial - tu negocio est√° creciendo.

Considera upgrade a [Plan superior]:
‚Üí [Beneficio 1]
‚Üí [Beneficio 2]
‚Üí [Precio claro]

[CTA: Ver opciones]
```

**Triggered:** 90 d√≠as sin login
```
Subject: Te echamos de menos, [Nombre]

No te hemos visto en un tiempo.
¬øTodo bien?

¬øNecesitas ayuda con algo?
¬øPodemos mejorar algo?

Responde y hablamos.
```

**Triggered:** NPS alto (9-10)
```
Subject: ¬øNos ayudas con una peque√±a cosa?

Veo que Itineramio te est√° funcionando bien.
¬øMe ayudar√≠as compartiendo tu experiencia?

[CTA: Dejar review en Trustpilot]

Por cierto: Si refiere a un amigo, ambos
obtienen 1 mes gratis.
[CTA: Compartir link de referido]
```

---

## üîÑ TRIGGERS & AUTOMATION

### Event-Based Triggers

```typescript
// Ejemplos de eventos que disparan emails

EVENT: user_registered
‚Üí Email: "Bienvenida + onboarding"
‚Üí Create journey: "Trial nurture sequence"
‚Üí Tag user: "trial_user"

EVENT: first_manual_created
‚Üí Email: "Celebraci√≥n + next steps"
‚Üí Add score: +20
‚Üí Check: If score > 50 ‚Üí Move to MQL

EVENT: property_limit_reached
‚Üí Email: "Upgrade suggestion"
‚Üí Tag: "ready_for_upsell"

EVENT: no_login_7_days (trial user)
‚Üí Email: "¬øNecesitas ayuda?"
‚Üí Tag: "at_risk"

EVENT: trial_ending_soon
‚Üí Email: "5 d√≠as restantes"
‚Üí If no response ‚Üí Email d√≠a 14

EVENT: subscription_activated
‚Üí Email: "Bienvenida premium"
‚Üí Remove from: Trial sequences
‚Üí Add to: Customer sequences
‚Üí Update stage: CUSTOMER

EVENT: subscription_cancelled
‚Üí Email: "Survey de salida"
‚Üí Update stage: CHURNED
‚Üí Add to: Win-back sequence (delayed 90 days)

EVENT: high_engagement_score
‚Üí Check: If not customer
‚Üí Email: "Oferta especial"
‚Üí Update stage: SQL

EVENT: low_engagement_7_days
‚Üí Reduce score: -5
‚Üí If customer ‚Üí Email: "¬øTodo ok?"

EVENT: referral_signup
‚Üí Email to referrer: "Gracias + cr√©dito"
‚Üí Email to referred: "Bienvenida especial"
```

---

## üíæ DATABASE SCHEMA

```prisma
// A√±adir a schema.prisma

model Lead {
  id          String   @id @default(cuid())
  name        String
  email       String
  source      String   // Tool descargado
  userAgent   String?
  ipAddress   String?
  createdAt   DateTime @default(now())

  // Relations
  journeyStages CustomerJourneyStage[]
  emailEvents   EmailEvent[]

  @@index([email])
  @@index([source])
  @@index([createdAt])
}

model CustomerJourneyStage {
  id              String   @id @default(cuid())
  userId          String?  // Si est√° registrado
  leadId          String?  // Si solo es lead
  email           String   // Siempre tenemos esto

  stage           JourneyStage
  score           Int      @default(0)

  enteredAt       DateTime @default(now())
  exitedAt        DateTime?

  // Metadata contextual
  metadata        Json?    // { source, utm_campaign, etc }

  // Relations
  lead            Lead?    @relation(fields: [leadId], references: [id])
  user            User?    @relation(fields: [userId], references: [id])

  @@index([email])
  @@index([stage])
  @@index([userId])
  @@index([leadId])
}

model EmailEvent {
  id              String   @id @default(cuid())
  email           String
  leadId          String?
  userId          String?

  eventType       EmailEventType
  campaignId      String?
  templateName    String

  subject         String
  sentAt          DateTime @default(now())
  deliveredAt     DateTime?
  openedAt        DateTime?
  clickedAt       DateTime?
  bouncedAt       DateTime?
  complainedAt    DateTime?

  metadata        Json?

  // Relations
  lead            Lead?    @relation(fields: [leadId], references: [id])
  user            User?    @relation(fields: [userId], references: [id])

  @@index([email])
  @@index([campaignId])
  @@index([eventType])
  @@index([sentAt])
}

model EmailCampaign {
  id              String   @id @default(cuid())
  name            String
  description     String?

  trigger         CampaignTrigger
  targetStages    JourneyStage[]

  isActive        Boolean  @default(true)
  priority        Int      @default(0)

  // Sequence config
  delayDays       Int?     // D√≠as despu√©s del trigger
  delayHours      Int?     // O horas espec√≠ficas

  // Email template
  templateName    String
  subject         String

  // Conditions
  conditions      Json?    // { minScore: 50, hasProperty: true }

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

enum JourneyStage {
  VISITOR
  LEAD
  REGISTERED
  MQL
  SQL
  CUSTOMER
  CHURNED
}

enum EmailEventType {
  SENT
  DELIVERED
  OPENED
  CLICKED
  BOUNCED
  COMPLAINED
  UNSUBSCRIBED
}

enum CampaignTrigger {
  LEAD_CAPTURED
  USER_REGISTERED
  MANUAL_CREATED
  TRIAL_STARTED
  TRIAL_ENDING
  SUBSCRIPTION_ACTIVATED
  SUBSCRIPTION_CANCELLED
  NO_LOGIN_7_DAYS
  NO_LOGIN_30_DAYS
  LIMIT_REACHED
  HIGH_SCORE
  MANUAL_SEND
}
```

---

## üèóÔ∏è IMPLEMENTATION ROADMAP

### Phase 1: Foundation (Semana 1)
- ‚úÖ Lead model (DONE)
- ‚è≥ CustomerJourneyStage model
- ‚è≥ EmailEvent model
- ‚è≥ EmailCampaign model
- ‚è≥ Scoring system b√°sico
- ‚è≥ Email service setup (Resend)

### Phase 2: Core Automation (Semana 2)
- Email templates (React Email)
- Welcome sequences
- Trial nurture sequence
- Event triggers b√°sicos
- Analytics dashboard (simple)

### Phase 3: Advanced Features (Semana 3-4)
- Lead scoring autom√°tico
- A/B testing
- Segmentaci√≥n avanzada
- Win-back campaigns
- Referral system

### Phase 4: Optimization (Ongoing)
- Analytics profundos
- Funnel visualization
- Cohort analysis
- Predictive churn detection
- AI-powered personalization

---

## üé® EMAIL TEMPLATES (React Email)

```typescript
// emails/templates/WelcomeLead.tsx
import { Button, Html, Text } from '@react-email/components'

interface WelcomeLeadProps {
  name: string
  resourceName: string
  downloadUrl: string
}

export default function WelcomeLead({
  name,
  resourceName,
  downloadUrl
}: WelcomeLeadProps) {
  return (
    <Html>
      <Text>Hola {name},</Text>

      <Text>
        Aqu√≠ est√° tu <strong>{resourceName}</strong>.
      </Text>

      <Button href={downloadUrl}>
        Descargar ahora
      </Button>

      {/* ... resto del template ... */}
    </Html>
  )
}
```

---

## üìä ANALYTICS & REPORTING

### M√©tricas clave a trackear:

**Funnel Conversion:**
- Visitor ‚Üí Lead: %
- Lead ‚Üí Registered: %
- Registered ‚Üí Customer: %
- Overall conversion rate

**Email Performance:**
- Open rate por stage
- Click rate por campaign
- Unsubscribe rate
- Best performing emails

**Customer Health:**
- Engagement score distribution
- Churn risk segments
- NPS por cohort
- Feature adoption

**Revenue:**
- CAC (Customer Acquisition Cost)
- LTV (Lifetime Value)
- LTV/CAC ratio
- Expansion revenue

---

## üöÄ QUICK WINS (Para empezar YA)

1. **Esta semana:**
   - Setup Resend account
   - Crear welcome email b√°sico
   - Implementar lead capture API (DONE)
   - Primer email autom√°tico cuando capturamos lead

2. **Pr√≥xima semana:**
   - Journey stages model
   - Scoring system b√°sico
   - Trial nurture sequence (3 emails)

3. **Mes 1:**
   - Analytics dashboard
   - 10 email templates core
   - Todos los triggers autom√°ticos

---

## üí° FILOSOF√çA FINAL

> "No se trata de cu√°ntos emails enviamos, sino de cu√°nto valor aportamos cada vez que aparecemos en su inbox."

**Cada email debe:**
1. ‚úÖ Aportar valor inmediato
2. ‚úÖ Ser relevante para su etapa actual
3. ‚úÖ Tener un prop√≥sito claro
4. ‚úÖ Respetar su tiempo
5. ‚úÖ Ser hermoso y profesional

**Nunca:**
- ‚ùå Spam diario
- ‚ùå Promociones agresivas
- ‚ùå Contenido gen√©rico
- ‚ùå Clickbait vac√≠o

---

## üìù NEXT STEPS INMEDIATOS

1. **Review esta arquitectura** - ¬øAlgo que cambiar/agregar?
2. **Setup Resend** - Crear cuenta y API key
3. **Crear modelos en Prisma** - Journey stages, Email events
4. **Primer email template** - Welcome lead
5. **Primer trigger** - Lead captured ‚Üí Send welcome

¬øEmpezamos? üöÄ
